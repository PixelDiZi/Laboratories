

## Цель работы  
Освоить процесс создания и настройки плагинов нормализации событий через веб-интерфейс KOMRAD SIEM 4.5 с использованием регулярных выражений.  

---

## Задачи работы  
- Создать новый плагин для нормализации событий из источника с тегом `custom_app`.  
- Настроить регулярные выражения для извлечения структурированных полей из сырых логов.  
- Протестировать работу плагина на тестовых событиях.  
- Привязать плагин к источнику данных.  

---

## Теоретическая часть  
### 1. Нормализация событий в KOMRAD  
**Нормализация** - процесс преобразования сырых логов в структурированные события с выделением ключевых полей. В KOMRAD 4.5 включает:  
- **Парсинг**: Извлечение данных через регулярные выражения  
- **Маппинг**: Сопоставление полей со стандартными атрибутами ECS (Elastic Common Schema)  
- **Обогащение**: Добавление геолокации, категоризации угроз  

### 2. Компоненты плагина  
1. **Регулярные выражения**: Группы захвата для извлечения значений  
2. **Шаблоны полей**:  
   - `timestamp`: Время события (обязательное)  
   - `event.severity`: Уровень критичности (1-99)  
   - `source.ip`: IP-адрес источника  
3. **Условия применения**: Фильтр по тегу источника  

### 3. Правила разработки плагинов  
- Использовать именованные группы `(?P<name>pattern)`  
- Стандартизация форматов времени (`ISO 8601`)  
- Валидация через встроенный тестер KOMRAD  

---

## Ход выполнения  

### Шаг 1: Создание плагина  
1. В веб-интерфейсе: **Администрирование** → **Плагины** → **Создать**  
2. Заполнить параметры:  
   - **Имя плагина**: `Parser_CustomApp_v1`  
   - **Тип**: `Нормализатор`  
   - **Тег источника**: `custom_app`  

### Шаг 2: Настройка регулярных выражений  
**Формат сырого события:**  
`[2023-10-05 12:34:56] WARNING: Login failed for user 'admin' from 192.168.1.10`  

**Регулярное выражение:**  
```regex
^\[(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})\]\s(?P<event.severity>\w+):\sLogin\s(?P<event.action>\w+)\sfor\suser\s'(?P<user.name>\w+)'\sfrom\s(?P<source.ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})
```  

**Маппинг полей:**  
`| Группа          | ECS-поле        | Тип данных |`  
`|-----------------|-----------------|------------|`  
`| timestamp       | @timestamp      | datetime   |`  
`| event.severity  | event.severity  | string     |`  
`| event.action    | event.action    | string     |`  
`| user.name       | user.name       | string     |`  
`| source.ip       | source.ip       | ip         |`  

### Шаг 3: Преобразование форматов  
1. Для поля `@timestamp`:  
```regex 
(?P<timestamp>\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2})
```  
2. Форматирование в ISO 8601:  
``` 
{{ timestamp | to_iso8601 }} 
```  

### Шаг 4: Тестирование плагина  
1. Провести тестирование:  
```json
{
  "raw_event": "[2023-10-05 12:34:56] WARNING: Login failed for user 'admin' from 192.168.1.10",
  "source": "custom_app"
}
```  
2. Проверить вывод:  
```json
{
  "@timestamp": "2023-10-05T12:34:56.000Z",
  "event.severity": "WARNING",
  "event.action": "failed",
  "user.name": "admin",
  "source.ip": "192.168.1.10"
}
```  

### Шаг 5: Привязка к источнику  
1. **Управление коллекторами** → **Источники** → `custom_app`  
2. В поле **Плагин нормализации** выбрать `Parser_CustomApp_v1`  

---

## Форма отчёта  
1. **Скриншоты интерфейса**:  
   - Окно создания плагина с параметрами  
   - Редактор регулярных выражений  
   - Успешный результат тестирования  


---

## Вопросы для самоконтроля  
1. Почему поле `@timestamp` обязательно для всех событий?  
2. Какие типы данных поддерживаются для полей в ECS?  
3. Как обработать события с разными форматами в одном источнике?  


